<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matematik Marketi</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        :root {
            --bg-color: #eef1f5;
            --panel-bg: #ffffff;
            --accent-color: #3498db;
            --secondary-color: #2ecc71;
            --text-color: #34495e;
            --light-text: #95a5a6;
            --border-color: #dfe6e9;
            --danger-color: #e74c3c;
        }
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .game-container {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 25px;
            width: 100%;
            max-width: 1100px;
        }
        .panel {
            background-color: var(--panel-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        h2 {
            margin-top: 0;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            color: var(--accent-color);
            font-weight: 900;
        }
        
        /* Sol Panel (Oyun AlanÄ±) */
        #points-display { text-align: center; }
        #points-display span {
            font-size: 4em;
            font-weight: 900;
            color: var(--secondary-color);
        }
        #info-note {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
        }
        #info-note h4 { margin: 0 0 10px 0; }
        #info-note ul { margin: 0; padding-left: 20px; }
        
        #game-area { text-align: center; margin-top: 20px; }
        #question-display { font-size: 4.5em; font-weight: 900; margin: 20px 0; }
        #answer-input {
            width: 200px;
            padding: 15px;
            font-size: 2em;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 10px;
        }
        #feedback-display { height: 30px; margin-top: 15px; font-weight: 700; font-size: 1.2em; }
        /* YENÄ°: Ceza uyarÄ±sÄ± iÃ§in stil eklendi */
        #penalty-display {
            height: 20px;
            margin-top: 5px;
            font-size: 0.9em;
            color: var(--danger-color);
            font-weight: 700;
        }
        .correct { color: var(--secondary-color); }
        .wrong { color: var(--danger-color); }

        /* SaÄŸ Panel (Market) */
        #market-header { display: flex; justify-content: space-between; align-items: center; }
        #add-reward-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
        }
        #market-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        .reward-item {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .reward-info h3 { margin: 0; font-size: 1.2em; }
        .reward-info p { margin: 5px 0 0 0; font-weight: 700; color: var(--accent-color); }
        .reward-claim button {
            padding: 10px 20px;
            font-size: 1em;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            background-color: var(--accent-color);
            color: white;
            cursor: pointer;
        }
        .reward-claim button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="panel">
            <h2>Oyun AlanÄ±</h2>
            <div id="points-display">
                <p style="margin:0; font-weight: 700;">Toplam Puan</p>
                <span id="current-points">0</span>
            </div>
            <div id="info-note">
                <h4>Puanlama Sistemi</h4>
                <ul>
                    <li>Toplama ve Ã‡Ä±karma: <strong>1 Puan</strong></li>
                    <li>Ã‡arpma: <strong>2 Puan</strong></li>
                    <li>BÃ¶lme: <strong>3 Puan</strong></li>
                </ul>
            </div>
            <div id="game-area">
                <div id="question-display"></div>
                <input type="number" id="answer-input" autocomplete="off">
                <div id="feedback-display"></div>
                <div id="penalty-display"></div>
            </div>
        </div>
        <div class="panel">
            <div id="market-header">
                <h2>Market</h2>
                <button id="add-reward-btn">Ã–dÃ¼l Ekle</button>
            </div>
            <div id="market-container">
                </div>
        </div>
    </div>
    <script>
    // --- DOM ELEMENTLERÄ° ---
    const currentPointsDisplay = document.getElementById('current-points');
    const questionDisplay = document.getElementById('question-display');
    const answerInput = document.getElementById('answer-input');
    const feedbackDisplay = document.getElementById('feedback-display');
    const penaltyDisplay = document.getElementById('penalty-display'); // YENÄ°
    const marketContainer = document.getElementById('market-container');
    const addRewardBtn = document.getElementById('add-reward-btn');
    
    // --- OYUN DEÄžÄ°ÅžKENLERÄ° ---
    let gameState = {
        points: 0,
        rewards: [], // {id, name, cost}
        wrongAnswerStreak: 0 // YENÄ°: YanlÄ±ÅŸ cevap sayacÄ±
    };
    let correctAnswerValue;
    let currentOperation; 

    // --- TEMEL OYUN FONKSÄ°YONLARI ---
    function initialize() {
        loadGame();
        updateUI();
        generateQuestion();
    }

    function generateQuestion() {
        answerInput.disabled = false;
        answerInput.value = '';
        answerInput.focus();
        feedbackDisplay.textContent = '';
        
        const operations = ['+', '-', '*', '/'];
        currentOperation = operations[Math.floor(Math.random() * operations.length)];
        let num1, num2;

        switch (currentOperation) {
            case '+':
                num1 = Math.floor(Math.random() * 50) + 1;
                num2 = Math.floor(Math.random() * 50) + 1;
                correctAnswerValue = num1 + num2;
                questionDisplay.textContent = `${num1} + ${num2}`;
                break;
            case '-':
                num2 = Math.floor(Math.random() * 50) + 1;
                num1 = num2 + Math.floor(Math.random() * 50) + 1;
                correctAnswerValue = num1 - num2;
                questionDisplay.textContent = `${num1} - ${num2}`;
                break;
            case '*':
                num1 = Math.floor(Math.random() * 12) + 1;
                num2 = Math.floor(Math.random() * 12) + 1;
                correctAnswerValue = num1 * num2;
                questionDisplay.textContent = `${num1} x ${num2}`;
                break;
            case '/':
                num2 = Math.floor(Math.random() * 12) + 1;
                correctAnswerValue = Math.floor(Math.random() * 12) + 1;
                num1 = num2 * correctAnswerValue;
                questionDisplay.textContent = `${num1} Ã· ${num2}`;
                break;
        }
    }

    function checkAnswer() {
        if (answerInput.disabled) return;
        const userAnswer = parseInt(answerInput.value);
        if (isNaN(userAnswer)) return;

        answerInput.disabled = true;
        let pointsGained = 0;

        if (userAnswer === correctAnswerValue) {
            switch (currentOperation) {
                case '+': case '-': pointsGained = 1; break;
                case '*': pointsGained = 2; break;
                case '/': pointsGained = 3; break;
            }
            gameState.points += pointsGained;
            gameState.wrongAnswerStreak = 0; // YENÄ°: DoÄŸru cevapta yanlÄ±ÅŸ sayacÄ±nÄ± sÄ±fÄ±rla
            feedbackDisplay.textContent = `DoÄŸru! +${pointsGained} Puan! ðŸŽ‰`;
            feedbackDisplay.className = 'correct';
            penaltyDisplay.textContent = ''; // YENÄ°: Ceza uyarÄ±sÄ±nÄ± temizle
            
            // YENÄ°: Konfetiyi patlat!
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        } else {
            gameState.wrongAnswerStreak++; // YENÄ°: YanlÄ±ÅŸ sayacÄ±nÄ± artÄ±r
            feedbackDisplay.textContent = `YanlÄ±ÅŸ! Cevap ${correctAnswerValue} idi.`;
            feedbackDisplay.className = 'wrong';

            // YENÄ°: Ceza mantÄ±ÄŸÄ±
            if (gameState.wrongAnswerStreak >= 3) {
                gameState.points = Math.max(0, gameState.points - 5); // Puan 0'Ä±n altÄ±na dÃ¼ÅŸmesin
                gameState.wrongAnswerStreak = 0; // SayacÄ± sÄ±fÄ±rla
                penaltyDisplay.textContent = "3 yanlÄ±ÅŸ! -5 Puan ceza!";
            } else {
                penaltyDisplay.textContent = `Dikkat! ${3 - gameState.wrongAnswerStreak} yanlÄ±ÅŸ daha yaparsan ceza alacaksÄ±n.`;
            }
        }

        updateUI();
        saveGame();
        setTimeout(generateQuestion, 1500);
    }

    function updateUI() {
        currentPointsDisplay.textContent = gameState.points.toLocaleString('tr-TR');
        renderMarket();
    }
    
    // --- MARKET FONKSÄ°YONLARI ---
    function renderMarket() {
        marketContainer.innerHTML = '';
        if (gameState.rewards.length === 0) {
            marketContainer.innerHTML = '<p style="color: #95a5a6; text-align: center;">Market boÅŸ. Veli olarak Ã¶dÃ¼l ekleyebilirsiniz.</p>';
        }
        gameState.rewards.forEach(reward => {
            const rewardDiv = document.createElement('div');
            rewardDiv.className = 'reward-item';
            rewardDiv.innerHTML = `
                <div class="reward-info">
                    <h3>${reward.name}</h3>
                    <p>${reward.cost.toLocaleString('tr-TR')} Puan</p>
                </div>
                <div class="reward-claim">
                    <button id="claim-${reward.id}">Al</button>
                </div>
            `;
            marketContainer.appendChild(rewardDiv);
            
            const claimButton = document.getElementById(`claim-${reward.id}`);
            claimButton.disabled = gameState.points < reward.cost;
            claimButton.onclick = () => claimReward(reward.id);
        });
    }

    function addReward() {
        const password = prompt("LÃ¼tfen yÃ¶netici ÅŸifresini girin:");
        if (password !== "veli123") {
            alert("Åžifre yanlÄ±ÅŸ!");
            return;
        }

        const rewardName = prompt("Ã–dÃ¼lÃ¼n adÄ±nÄ± girin (Ã¶rn: Hamburger):");
        if (!rewardName) return;

        const rewardCost = parseInt(prompt(`"${rewardName}" iÃ§in gereken puanÄ± girin (Ã¶rn: 500):`));
        if (isNaN(rewardCost) || rewardCost <= 0) {
            alert("LÃ¼tfen geÃ§erli bir puan girin.");
            return;
        }

        gameState.rewards.push({ id: Date.now(), name: rewardName, cost: rewardCost });
        alert(`'${rewardName}' Ã¶dÃ¼lÃ¼ ${rewardCost} puan ile markete eklendi!`);
        updateUI();
        saveGame();
    }
    
    function claimReward(rewardId) {
        const rewardIndex = gameState.rewards.findIndex(r => r.id === rewardId);
        if (rewardIndex === -1) return;

        const reward = gameState.rewards[rewardIndex];
        if (gameState.points >= reward.cost) {
            if (confirm(`"${reward.name}" Ã¶dÃ¼lÃ¼nÃ¼ ${reward.cost} puana almak istediÄŸine emin misin?`)) {
                gameState.points -= reward.cost;
                gameState.rewards.splice(rewardIndex, 1);
                alert(`Tebrikler! "${reward.name}" Ã¶dÃ¼lÃ¼nÃ¼ kazandÄ±n!`);
                updateUI();
                saveGame();
            }
        }
    }

    // --- KAYIT SÄ°STEMÄ° ---
    function saveGame() {
        localStorage.setItem('mathMarketSave', JSON.stringify(gameState));
    }

    function loadGame() {
        const savedData = localStorage.getItem('mathMarketSave');
        if (savedData) {
            const loadedState = JSON.parse(savedData);
            // YENÄ°: KayÄ±ttan yÃ¼klerken yeni eklenen `wrongAnswerStreak` alanÄ± kontrol ediliyor.
            gameState.points = loadedState.points || 0;
            gameState.rewards = loadedState.rewards || [];
            gameState.wrongAnswerStreak = loadedState.wrongAnswerStreak || 0;
        }
    }

    // --- OLAY DÄ°NLEYÄ°CÄ°LERÄ° ---
    answerInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkAnswer(); });
    addRewardBtn.addEventListener('click', addReward);

    // Oyunu BaÅŸlat
    initialize();
    </script>
</body>
</html>